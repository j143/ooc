<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
    <!-- SVG Definitions for markers and filters -->
    <defs>
        <marker id="arrow-green" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#28a745" />
        </marker>
        <marker id="arrow-red" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#dc3545" />
        </marker>
        <marker id="arrow-blue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#007bff" />
        </marker>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
            <feOffset dx="2" dy="2" result="offsetblur"/>
            <feMerge>
                <feMergeNode/>
                <feMergeNode in="SourceGraphic"/>
            </feMerge>
        </filter>
    </defs>

    <!-- Main Title -->
    <text x="400" y="40" font-size="24" font-weight="bold" text-anchor="middle">Paper Framework: Buffer Manager</text>

    <!-- Backend Layer -->
    <rect x="150" y="80" width="500" height="50" rx="10" fill="#e9ecef" stroke="#adb5bd" filter="url(#shadow)"/>
    <text x="400" y="110" font-size="16" font-weight="bold" text-anchor="middle">Backend Layer (e.g., fused_add_multiply)</text>
    
    <!-- Request Arrow -->
    <path d="M 400 130 V 170" stroke="#007bff" stroke-width="2" marker-end="url(#arrow-blue)"/>
    <text x="410" y="155" font-size="14" fill="#007bff">1. get_tile(A, r, c)</text>

    <!-- Buffer Manager Layer -->
    <rect x="50" y="170" width="700" height="260" rx="10" fill="#f8f9fa" stroke="#adb5bd" filter="url(#shadow)"/>
    <text x="400" y="195" font-size="16" font-weight="bold" text-anchor="middle">Buffer Manager</text>

    <!-- In-Memory Cache -->
    <rect x="100" y="220" width="250" height="180" rx="5" fill="#d4edda" stroke="#c3e6cb"/>
    <text x="225" y="240" font-size="14" font-weight="bold" text-anchor="middle">In-Memory Cache</text>
    <rect x="125" y="260" width="50" height="30" rx="3" fill="#fff"/>
    <text x="150" y="280" font-size="10" text-anchor="middle">Tile 1</text>
    <rect x="185" y="260" width="50" height="30" rx="3" fill="#fff"/>
    <text x="210" y="280" font-size="10" text-anchor="middle">Tile 2</text>
    <rect x="125" y="300" width="50" height="30" rx="3" fill="#fff"/>
    <text x="150" y="320" font-size="10" text-anchor="middle">Tile 3</text>
    <rect x="185" y="300" width="50" height="30" rx="3" fill="#fff"/>
    <text x="210" y="320" font-size="10" text-anchor="middle">Tile N</text>

    <!-- LRU Tracker -->
    <rect x="450" y="220" width="250" height="180" rx="5" fill="#e2e3e5" stroke="#d6d8db"/>
    <text x="575" y="240" font-size="14" font-weight="bold" text-anchor="middle">LRU Tracker</text>
    <text x="575" y="270" font-size="12" text-anchor="middle" fill="#6c757d">Least Recently Used</text>
    <path d="M 480 290 H 670" stroke="#6c757d" stroke-width="2" marker-end="url(#arrow-blue)"/>
    <text x="575" y="320" font-size="12" text-anchor="middle" fill="#6c757d">Most Recently Used</text>

    <!-- Cache Hit Path -->
    <path d="M 400 210 C 350 210, 300 250, 300 300" stroke="#28a745" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
    <path d="M 300 300 C 300 350, 350 390, 400 390 V 410" stroke="#28a745" stroke-width="2" fill="none" marker-end="url(#arrow-green)"/>
    <text x="260" y="210" font-size="14" fill="#28a745" font-weight="bold">2a. Cache Hit</text>
    <text x="410" y="425" font-size="14" fill="#28a745">3a. Return Tile from RAM</text>

    <!-- Cache Miss Path -->
    <path d="M 400 210 C 450 210, 500 250, 500 300" stroke="#dc3545" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
    <path d="M 500 300 C 500 350, 450 390, 400 390 V 430" stroke="#dc3545" stroke-width="2" fill="none"/>
    <text x="540" y="210" font-size="14" fill="#dc3545" font-weight="bold">2b. Cache Miss</text>

    <!-- Disk I/O Path -->
    <path d="M 400 430 V 480" stroke="#dc3545" stroke-width="2" marker-end="url(#arrow-red)"/>
    <text x="410" y="460" font-size="14" fill="#dc3545">3b. Load from Disk</text>

    <!-- Core Layer (Disk) -->
    <rect x="150" y="480" width="500" height="50" rx="10" fill="#6c757d" stroke="#495057" filter="url(#shadow)"/>
    <text x="400" y="510" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Core Layer: PaperMatrix (on Disk)</text>
    
    <!-- Return Path from Disk -->
    <path d="M 350 480 V 410 C 350 350, 250 350, 225 340" stroke="#dc3545" stroke-width="2" fill="none" marker-end="url(#arrow-red)"/>
    <text x="200" y="440" font-size="14" fill="#dc3545">4b. Add to Cache</text>
    <text x="200" y="455" font-size="12" fill="#6c757d">(Evict LRU if full)</text>
</svg>

